#{extends 'main.html' /}
#{set title:'Últimas Notícias' /}

<!-- Page Header-->

       <header class="masthead" style="background-image: url(@{'/public/startbootstrap-clean-blog-gh-pages/assets/img/home-bg.jpg'})">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="site-heading">
							<h1><a href="@{Noticias.listar}" id="logo">
							<img src="@{'/public/images/logo-ompa.png'}" alt="Logo OMPA" height="180px" />
							</a></h1>
                        
                            <span class="subheading" style="color: rgb(118, 227, 9);">Fique por dentro do universo olímpico da matemática!</span>
                        </div>
                    </div>
                </div>
            </div>
      </header>
	  #{if flash.success}
	  											    <div class="alert alert-success alert-dismissible fade show" role="alert">
	  											        ${flash.success}
	  											    </div>
	  											#{/if}

	  											#{if flash.error}
	  											    <div class="alert alert-danger alert-dismissible fade show" role="alert">
	  											        ${flash.error}
	  											    </div>
	  											#{/if}
	
	  								<br/>
									
									<form class="d-flex mx-auto" id="buscarNoticias" role="search" action="@{Noticias.listar()}" style="max-width: 600px; width: 100%;">
																						<input class="form-control me-2" type="search" name="termo" 
																							placeholder="Buscar notícias por autor ou título" 
																							value="${termo}">
																						<button class="btn btn-outline-light" type="submit"  style="color: rgb(118, 227, 9);">Buscar</button>
																						</form>
																						
				
																						<!--Na linha com os registros você coloca no append-->
																						
																						
																						
																						<div class="container px-4 px-lg-5">
																							              <div class="row gx-4 gx-lg-5 justify-content-center">
																							                  <div class="col-md-10 col-lg-8 col-xl-7">
																												
																											
																							                      <!-- Post preview-->
																												  <div id="resultado">
																													
																												  </div>
																												  
																												  <script type="text/javascript">
																												  $(document).ready(function () {

																												      function buscarNoticias() {
																												          $.ajax({
																												              type: "post",
																												              url: "@{Noticias.listarAjax}",
																												              data: $("#buscarNoticias").serialize(), // termo vazio = null
																												              success: function (data) {

																												                  $("#resultado").empty();

																												                  // ✅ Caso não exista nenhuma notícia
																												                  if (!data || data.length === 0) {
																												                      $("#resultado").html(
																												                          '<p class="text-center text-muted mt-4">' +
																												                          'Nenhuma notícia cadastrada no sistema.' +
																												                          '</p>'
																												                      );
																												                      return;
																												                  }

																												                  $.each(data, function (i, item) {

																												                      let conteudoResumo = item.conteudo.length > 80
																												                          ? item.conteudo.substring(0, 80) + "..."
																												                          : item.conteudo;

																												                      let html =
																												                          '<div class="post-preview position-relative">' +
																												                              '<a href="/comentarios/listar?noticiaId=' + item.id + '" style="color:#6a0dad">' +
																												                                  '<h2 class="post-title">' + item.titulo + '</h2>' +
																												                                  '<h3 class="post-subtitle">' + conteudoResumo + '</h3>' +
																												                              '</a>' +
																												                              '<p class="post-meta">' +
																												                                  'Publicado por <a href="#">' + item.nomeAutor + '</a> em ' + item.dataPublicacao +
																												                              '</p>' +

																												                              '<div class="position-absolute bottom-0 end-0 mb-2 me-2">' +
																												                                  '<a href="/noticias/editar?id=' + item.id + '" class="btn btn-sm btn-outline-primary me-1">Editar</a>' +
																												                                  '<a href="/noticias/remover?id=' + item.id + '" class="btn btn-sm btn-outline-danger" ' +
																												                                     'onclick="return confirm(\'Deseja realmente excluir esta notícia?\')">Excluir</a>' +
																												                              '</div>' +
																												                          '</div>' +
																												                          '<hr class="my-4" />';

																												                      $("#resultado").append(html);
																												                  });
																												              }
																												          });
																												      }

																												      // ✅ 1️⃣ carrega automaticamente ao abrir /noticias/listar
																												      buscarNoticias();

																												      // ✅ 2️⃣ continua funcionando ao buscar
																												      $("#buscarNoticias").submit(function (e) {
																												          e.preventDefault();
																												          buscarNoticias();
																												      });

																												  });
																												  </script>							 
																																													
																						<div class="d-flex justify-content-end mb-4"><a class="btn btn-outline-success text-uppercase" href="@{Noticias.form}">Cadastrar Nova Notícia →</a></div>
																						
																						</div>
																						</div>
																						</div>
			
